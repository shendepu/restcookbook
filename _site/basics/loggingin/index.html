<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="I want users to login into my RESTful API so only they can see (protected) resources. What is the correct way to do this?">

<title>How do I let users log into my RESTful API? - The RESTful cookbook</title>

<!-- favicon -->
<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/base.css">
<link rel="stylesheet" type="text/css" href="/css/restcookbook.css">

<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif] d-->

<!-- Google fonts -->
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic&subset=latin-ext">

    
</head>

<body>
    <a href="https://github.com/restcookbook/restcookbook"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
    <header id="l-header">
    <div class="container">
        <div class="row logo">
            <h1><a href="/">restcookbook.com</a></h1>
            <p>How to do stuff RESTful</p>
        </div>

    </div>
</header>


    <div class="container">
        <div class="row">

            <div id="content" class="col-xs-12 col-sm-9 col-sm-push-3">

                

                <h2 class="question">I want users to login into my RESTful API so only they can see (protected) resources. What is the correct way to do this?</h2>

<p>One of the main differences between RESTful and other server-client communications services is that any session state in a RESTful setup is held in the client, the server is stateless. This requires the client to provide all information necessary to make the request.</p>

<h3>Using HTTP basic authentication</h3>
<p>The most simple way to deal with authentication is to use HTTP basic authentication. We use a special HTTP header where
    we add 'username:password' encoded in base64.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">GET / HTTP/1.1
Host: example.org
Authorization: Basic Zm9vOmJhcg==</code></pre></figure>

<p>
Note that even though your credentials are encoded, they are not encrypted! It is very easy to retrieve the username and
password from a basic authentication. Do not use this authentication scheme on plain HTTP, but only through SSL/TLS.</p>

<h3>HMAC</h3>
<p>One of the downsides of basic authentication is that we need to send over the password on every request. Also, it
    does not safeguard against tampering of headers or body. Another way is to use HMAC (hash based message authentication).
Instead of having passwords that need to be sent over, we actually send a hashed version of the password, together with more information.

Let's assume we have the following credentials: username "johndoe", password "secret". Suppose we try to access a protected resource <b>/users/johndoe/financialrecords</b>.

First, we need to fetch all the information we need, and concatenate this.

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">GET+/users/johndoe/financialrecords</code></pre></figure>

<p>Here, we just concatenate the HTTP verb and the actual URL. We could add other information as well, like the current timestamp, a
    random number, or the md5 of the message body in order to prevent tampering of the body, or prevent replay attacks. Next, we generate
    a hmac:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">digest = base64encode(hmac("sha256", "secret", "GET+/users/johndoe/financialrecords"))</code></pre></figure>

<p>This digest we can send over as a HTTP header:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">GET /users/johndoe/financialrecords HTTP/1.1
Host: example.org
Authentication: hmac johndoe:[digest]</code></pre></figure>

<p>
Right now, the server knows the user "johndoe" tries to access the resource. The server can generate the digest as
well, since it has all information. (Note that the "password" is not encrypted on the server, as the server needs to know
the actual value. Hence we call this a "secret", not a "password").
</p>

<p>
Even if somebody was listening in on the conversation, they could not use the authentication information to POST data to
john's financial records, or look at some other users financial records, or any other URL, as this would change the digest and
the eavesdropper does not have the secret that both the server and client has.</p>
<p>
However, the eavesdropper could access John's financial records whenever it wants since it doesn't change the digest. This
    is why many times more information is send over, like the current time, and a nonce:
</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">digest = base64encode(hmac("sha256", "secret", "GET+/users/johndoe/financialrecords+20apr201312:59:24+123456"))</code></pre></figure>

<p>We added two extra pieces of information. The current date and a number that we only use once (nonce)</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">GET /users/johndoe/financialrecords HTTP/1.1
Host: example.org
Authentication: hmac johndoe:123456:[digest]
Date: 20 apr 2013 12:59:24</code></pre></figure>

<p>
The server can reconstruct the digest again, since the client sends over the nonce and date. When the date is not in a
certain range of the current servers time (say, 10 minutes), the server can ignore the message, as it probably is a
replay of an earlier send message (note: either that, or the server or clients time is wrong. This is a common issue when
dealing with time-limited authentications!).
</p>

<p>
The nonce is a number we only use once. If we want to access the same resource again, we MUST change this number. This
means that every time we access a resource, the nonce will be different, and thus the digest will be different, even if we
access the resource in the same second. This way we are sure that no replay attacks can be done. Each request is only valid
once, and only once.</p>

<h3>OAuth</h3>
<p>One of the downsides of hmac is that there are no more passwords, but just plain secrets. When johns secret gets out,
    everyone could use that secret to access the account of john. A common way to prevent this is to use temporary
    tokens. John "asks" the server for a "token" and "secret", and with these token and secret, it is allowed to access its
    protected resources.</p>
<p>OAuth is a mechanism that allows you to create temporary tokens. It is a common used scheme for authentication and
    authorization, however the OAuth(1.1) specification is a bit difficult to implement for beginners. However, many
    libraries in pretty much every language exist to make this much easier to implement.</p>

<h3>OAuth2</h3>
<p>Even though the name suggests its the next version of OAuth, the whole structure has changed radically and cannot even
    be considered a new version. OAuth2 is a complete new way of authentication which is easier to implement and maintain.
    However, OAuth2 is not officially a standard yet, although many sites and organizations are using the current drafts.</p>

<h3>See also</h3>
<ul>
    <li><a href="http://tools.ietf.org/html/rfc7235#section-2">RFC 7235 - Access Authentication Framework</a>
    <li><a href="http://tools.ietf.org/html/rfc2617">RFC 2617 - HTTP Authentication: Basic and Digest Access Authentication</a>
    <li><a href="http://oauth.net/">OAuth specifications</a>
    <li><a href="http://tools.ietf.org/html/rfc6749">RFC 6749 - OAuth2 proposed standard</a>
</ul>

<h3>Caveats</h3>
<ul>
    <li>Basic authentication and OAuth versions MUST be protected through SSL/TLS. They should not be used over plain HTTP.</li>
    <li>Using nonces can improve your security, but you MUST store and compare nonces server-side.</li>
    <li>A common issue when using time-windows for request, is that either server or client is not using the correct time. Make
        sure both server and client are using systems like NTP to keep times in sync</li>
</ul>


                <hr>

                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = "restcookbook";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

            </div>
            <div class="col-xs-12 col-sm-3 col-sm-pull-9 sidebar">
                <h2>Topics</h2>
<ul class="topics">


    <li class="topic-header"><b>Basics</b> (5 recipes)</li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/basics/loggingin/">How do I let users log into my RESTful API?</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/basics/caching/">Caching your REST API</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/basics/versioning/">How do I version my REST API?</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/basics/hateoas/">What is HATEOAS and why is it important?</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/basics/codeondemand/">What is the code-on-demand constraint?</a></li>
        </ul>
    </li>
    

    <li class="topic-header"><b>HTTP Headers</b> (1 recipe)</li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/http%20headers/acceptlanguage/">Unsatisfied Accept-Language header</a></li>
        </ul>
    </li>
    

    <li class="topic-header"><b>HTTP Methods</b> (5 recipes)</li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/http%20methods/options/">How do I know which HTTP methods are supported</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/http%20methods/put-vs-post/">When to use PUT or POST</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/http%20methods/patch/">When to use the PATCH method</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/http%20methods/idempotency/">What are idempotent and/or safe methods?</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/http%20methods/400-vs-500/">When to send 4xx or 5xx codes</a></li>
        </ul>
    </li>
    

    <li class="topic-header"><b>Mediatypes</b> (1 recipe)</li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/mediatypes/json/">Is my API RESTful when I use JSON?</a></li>
        </ul>
    </li>
    

    <li class="topic-header"><b>Miscellaneous</b> (3 recipes)</li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/miscellaneous/richardsonmaturitymodel/">What is the Richardson Maturity Model?</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/miscellaneous/rest-and-http/">Are REST and HTTP the same thing?</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/miscellaneous/rest-presentations/">Where to find REST presentations</a></li>
        </ul>
    </li>
    

    <li class="topic-header"><b>Resources</b> (4 recipes)</li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/resources/using-custom-content-types/">Custom content-types</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/resources/pagination/">Paginating collections</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/resources/link-types/">Using link-types in relations</a></li>
        </ul>
    </li>
    
    <li>
        <ul class='subnavlist'>
            <li class='recipe'><a href="/resources/asynchroneous-operations/">Asynchronous operations</a></li>
        </ul>
    </li>
    


</ul>

            </div>
        </div>

    </div>

    
<footer id="l-footer">
    <div class="container">

        <p id="legal">
            Maintained by Joshua Thijssen | Powered by <a href="http://jekyllrb.com">Jekyll</a> &amp; <a href="http://github.com/restcookbook">GitHub</a> | Design adapted on jekyll theme by <a href="http://unifreak.github.io">UniFreak</a>
        </p>
    </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-53222355-1', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>
